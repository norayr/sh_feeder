run:
    image: python:3.5-alpine
    script:
    - pip3 install -r requirements.txt -q
    - ./pod_feeder.py
        --pod-url   $K8S_SECRET_POD_FEEDER_TEST_POD
        --username  $K8S_SECRET_POD_FEEDER_TEST_USER
        --password  $K8S_SECRET_POD_FEEDER_TEST_PASSWORD
        --aspect-id $K8S_SECRET_POD_FEEDER_TEST_ASPECT_ID
        --database feed.db
        --feed-id eff
        --feed-url https://www.eff.org/rss/updates.xml
        --auto-tag foo
        --auto-tag bar
        --ignore-tag bar
        --category-tags
        --embed-image
        --summary
        --via gitlb-ci
        --limit 1
        --debug
    - ./pod_feeder.py
        --pod-url   $K8S_SECRET_POD_FEEDER_TEST_POD
        --username  $K8S_SECRET_POD_FEEDER_TEST_USER
        --password  $K8S_SECRET_POD_FEEDER_TEST_PASSWORD
        --aspect-id $K8S_SECRET_POD_FEEDER_TEST_ASPECT_ID
        --database feed.db
        --feed-id gitlab
        --feed-url $CI_PROJECT_URL/commits/$CI_COMMIT_REF_NAME?format=atom
        --embed-image
        --full
        --limit 1
        --debug
    - ./clean_db.py feed.db

formatting:
    # Black requires python >= 3.6
    image: python:alpine
    allow_failure: true
    script:
    - pip3 install -q black
    - black --check .
